# S-08: Notification Channels (Email/Slack)

**Last updated:** 2025-09-21

## Outcome
- Deliver daily report summaries through the notification channels defined in configuration, enabling operators to act without opening the repo.

## Deliverables
- `trading_system.notify` module supporting email (SMTP) and Slack webhook delivery with structured payloads.
- CLI command `ts notify send --config configs/sample-config.yml --asof 2024-05-02 [--channel email|slack|all]` that dispatches notifications referencing report artifacts.

## Functional Requirements
- Subject/heading includes the `asof` date and market state (from risk alerts).
- Email body summarizes key sections (alerts, rebalance actions) and includes links to HTML/PDF report; Slack message uses blocks for readability.
- Gracefully handle missing channel credentials by logging warnings and exiting non-zero when all channels fail.
- Support dry-run mode that prints the composed message without sending (for CI/testing).

## CLI Additions
- `poetry run ts notify send --config <path> --asof YYYY-MM-DD --channel all` reads `reports/<asof>/daily_report.*` and dispatches notifications.
- `poetry run ts notify preview --config <path> --asof YYYY-MM-DD --channel slack` outputs the payload JSON for inspection.

## Verification
1. Configure dummy SMTP/Slack endpoints (or use local test servers) and run the CLI in dry-run mode to review message formatting.
2. Execute real send against a test inbox/webhook and verify receipt with correct subject, links, and summary.
3. Disconnect a channel (e.g., missing webhook) and confirm the command exits non-zero with a clear error message.
4. Run unit/integration tests mocking transport layers to prove formatting and error handling.

## Dependencies
- S-01, S-07 (needs report artifacts).

## Notes
- Sensitive credentials should come from environment variables or secrets files; document requirements in `README.md`.
