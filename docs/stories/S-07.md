# S-07: Report Builder (HTML/PDF/JSON)

**Last updated:** 2025-09-21

## Outcome
- Assemble daily operator reports summarizing holdings, risk alerts, signals, and rebalance proposals in HTML, PDF, and JSON formats.
- Ensure reports are consistent, accessible, and traceable back to input artifacts.

## Deliverables
- `trading_system.report` module capable of ingesting curated metrics, holdings, risk alerts, and proposal data to produce HTML and JSON outputs; PDF rendered via wkhtmltopdf or similar.
- Templating system (Jinja2 or equivalent) with branded layout and sections aligned with `WORKFLOW.md`.
- CLI command `ts report build --config configs/sample-config.yml --asof 2024-05-02 --include-pdf` generating report artifacts under `reports/<asof>/`.

## Functional Requirements
- Required sections: portfolio snapshot (positions, weights, P&L), risk summary (alerts, market state), actions (exits, rebalance orders), performance metrics (rolling returns/Sharpe).
- JSON report mirrors the HTML content structurally for downstream automation.
- Embed references to source files (paths, hashes) to support traceability.
- Handle cases where optional inputs (rebalance proposal) are absent, clearly stating "None scheduled".

## CLI Additions
- `poetry run ts report build --config <path> --asof YYYY-MM-DD [--include-pdf]` renders HTML/JSON (and PDF when flag set).
- `poetry run ts report preview --config <path> --asof YYYY-MM-DD --open` launches a local web preview for QA (optional flag, no-op in CI).

## Verification
1. Provide fixture inputs (holdings, curated metrics, risk alerts, proposal) and run the CLI.
2. Validate generated HTML contains all mandatory sections and references to the same `asof` date.
3. Confirm JSON matches HTML content (e.g., identical counts, totals) and includes artifact manifest references.
4. When `--include-pdf` is set, ensure PDF renders successfully in CI-friendly environment (or gracefully skips if renderer unavailable, with documented fallback).
5. Execute unit tests for templating and snapshot tests for golden HTML/JSON outputs.

## Dependencies
- S-01, S-05, S-06.

## Notes
- Keep styling minimal and print-friendly; ensure PDFs render deterministically across environments.
