# S-01: Configuration Loader and Path Contracts

**Last updated:** 2025-09-21

## Outcome
- Provide a typed configuration model and loader that downstream modules can trust for directory structure, data policies, and strategy parameters.
- Ensure canonical directories (`data/raw`, `data/curated`, `reports`) exist before any pipeline step executes, matching the workflow contract.

## Deliverables
- `trading_system.config` module with Pydantic models (`Config`, `DataConfig`, `UniverseConfig`, `StrategyConfig`, `RiskConfig`, `RebalanceConfig`, `NotifyConfig`, `PathsConfig`, `PreprocessConfig`).
- `load_config(path: str | Path) -> Config` function that resolves relative paths relative to the configuration file and creates directories on load.
- `configs/sample-config.yml` (or README snippet) demonstrating required fields and defaults.
- CLI command `ts config inspect --path configs/sample-config.yml` that loads the config, validates it, and prints summarized sections (base currency, universe, paths, notify settings).

## Functional Requirements
- Loader must reject missing top-level sections with actionable error messages.
- Path resolution must expand user home (`~`) and relative paths, returning fully resolved paths.
- Directory creation is idempotent; repeated loads do not modify contents beyond ensuring existence.
- Config models accept forward-compatible extra keys (except in `PathsConfig`, which should ignore extras) to allow future stories to extend the contract.

## CLI Additions
- `poetry run ts config inspect --path <config.yml>` validates the configuration, prints resolved directories, and exits non-zero on validation failures.
- `poetry run ts config new --path configs/generated-config.yml --template default` writes a commented template to disk for operator onboarding.

## Verification
1. Create the sample configuration and run `poetry run ts config inspect --path configs/sample-config.yml`; verify paths are resolved and directories exist afterwards.
2. Modify the sample config to remove the `paths` section; confirm the command exits with an error message referencing the missing section.
3. Run `poetry run mypy src/trading_system/config.py` to ensure strict typing passes.
4. Execute `pytest tests/test_config.py` to validate contract scenarios (missing keys, directory creation, extra field handling).

## Dependencies
- S-00.

## Notes
- The config contract underpins every downstream module; any additions must remain backward compatible or be versioned explicitly.
